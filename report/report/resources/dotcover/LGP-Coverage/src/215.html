<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_215 = [
   [25,9,25,37,'dccv']
, [26,9,26,10,'dccv']
, [27,13,27,55,'dccv']
, [28,9,28,10,'dccv']
, [39,9,39,10,'dccv']
, [41,13,41,14,'dccv']
, [42,17,42,54,'dccv']
, [43,17,43,73,'dccv']
, [44,13,44,14,'dccv']
, [49,9,49,10,'dccv']
, [78,9,78,10,'dccv']
, [80,13,80,14,'dccv']
, [81,17,81,24,'dccv']
, [81,37,81,56,'dccv']
, [81,26,81,33,'dccv']
, [82,17,82,18,'dccv']
, [83,21,83,50,'dccv']
, [84,21,84,22,'dccv']
, [85,25,85,49,'dccv']
, [86,21,86,22,'dccv']
, [87,17,87,18,'dccv']
, [81,34,81,36,'dccv']
, [88,13,88,14,'dccv']
, [93,9,93,10,'dccv']
, [102,9,102,10,'dccv']
, [104,13,104,14,'dccv']
, [105,17,105,49,'dccv']
, [107,17,112,19,'dccv']
, [114,17,114,64,'dccv']
, [115,17,115,18,'dccv']
, [116,21,116,54,'dccv']
, [117,17,117,18,'dccv']
, [118,13,118,14,'dccv']
, [123,9,123,10,'dccv']
, [132,9,132,10,'dccv']
, [134,13,134,14,'dccv']
, [135,17,135,54,'dccv']
, [136,17,136,73,'dccv']
, [137,13,137,14,'dccv']
, [142,9,142,10,'dccv']
, [146,9,146,10,'dccv']
, [147,13,147,20,'dccv']
, [147,33,147,52,'dccv']
, [147,30,147,32,'dccv']
, [154,13,154,26,'dccv']
, [155,9,155,10,'dccv']
, [159,9,159,10,'dccv']
, [160,13,160,74,'dccv']
, [161,13,161,14,'dccv']
, [162,17,162,98,'dccv']
, [163,17,163,92,'dccv']
, [164,17,164,84,'dccv']
, [166,17,166,42,'dccv']
, [167,17,167,18,'dccv']
, [168,21,168,90,'dccv']
, [169,17,169,18,'dccv']
, [171,17,171,39,'dccv']
, [172,17,172,18,'dccv']
, [173,21,173,87,'dccv']
, [174,17,174,18,'dccv']
, [176,17,176,35,'dccv']
, [181,17,181,110,'dccv']
, [182,13,182,14,'dccv']
, [183,9,183,10,'dccv']
, [187,9,187,10,'dccv']
, [189,13,189,14,'dccv']
, [190,22,190,32,'dccv']
, [191,17,191,18,'dccv']
, [192,21,192,64,'dccv']
, [197,21,197,57,'dccv']
, [199,21,199,93,'dccv']
, [200,21,200,102,'dccv']
, [202,21,202,45,'dccv']
, [208,21,208,49,'dccv']
, [209,21,209,22,'dccv']
, [210,25,210,65,'dccv']
, [211,25,211,84,'dccv']
, [212,21,212,22,'dccv']
, [214,21,214,52,'dccv']
, [215,21,215,22,'dccv']
, [216,25,216,68,'dccv']
, [217,25,217,84,'dccv']
, [218,21,218,22,'dccv']
, [219,17,219,18,'dccv']
, [190,64,190,67,'dccv']
, [190,33,190,62,'dccv']
, [220,13,220,14,'dccv']
, [225,9,225,10,'dccv']
, [45,13,45,37,'dcuc']
, [46,13,46,14,'dcuc']
, [47,17,47,53,'dcuc']
, [48,13,48,14,'dcuc']
, [59,9,59,10,'dcuc']
, [61,13,61,14,'dcuc']
, [62,17,62,54,'dcuc']
, [63,17,63,73,'dcuc']
, [64,13,64,14,'dcuc']
, [65,13,65,37,'dcuc']
, [66,13,66,14,'dcuc']
, [67,17,67,53,'dcuc']
, [68,13,68,14,'dcuc']
, [69,9,69,10,'dcuc']
, [89,13,89,37,'dcuc']
, [90,13,90,14,'dcuc']
, [91,17,91,53,'dcuc']
, [92,13,92,14,'dcuc']
, [119,13,119,37,'dcuc']
, [120,13,120,14,'dcuc']
, [121,17,121,53,'dcuc']
, [122,13,122,14,'dcuc']
, [138,13,138,37,'dcuc']
, [139,13,139,14,'dcuc']
, [140,17,140,53,'dcuc']
, [141,13,141,14,'dcuc']
, [147,22,147,29,'dcuc']
, [148,13,148,14,'dcuc']
, [149,17,149,81,'dcuc']
, [150,17,150,18,'dcuc']
, [151,21,151,33,'dcuc']
, [153,13,153,14,'dcuc']
, [177,17,177,18,'dcuc']
, [178,21,178,83,'dcuc']
, [179,17,179,18,'dcuc']
, [193,21,193,22,'dcuc']
, [194,25,194,34,'dcuc']
, [203,21,203,22,'dcuc']
, [204,25,204,61,'dcuc']
, [205,25,205,84,'dcuc']
, [206,21,206,22,'dcuc']
, [221,13,221,37,'dcuc']
, [222,13,222,14,'dcuc']
, [223,17,223,53,'dcuc']
, [224,13,224,14,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src215" class="dotCoverSource"><pre>#region

using System;
using System.Collections.Generic;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;
using LGP.Components.Factory;
using LGP.Components.Factory.Interfaces.Infrastructure;

#endregion

namespace LGP.Components.Menus
{
    /// &lt;summary&gt;
    /// Conext menus handler
    /// &lt;/summary&gt;
    public class ContextMenusHandler : IContextMenus
    {
        private readonly List&lt; Entry &gt; _registrations;

        /// &lt;summary&gt;
        /// Constructor
        /// &lt;/summary&gt;
        public ContextMenusHandler()
        {
            this._registrations = new List&lt; Entry &gt;();
        }

        #region Implementation of IContextMenus

        /// &lt;summary&gt;
        ///   Asks the Context menu handler to append menu entries for a given context menu
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;menuparent&quot;&gt;Conext menu to add entries to&lt;/param&gt;
        /// &lt;param name = &quot;type&quot;&gt;Type of item that the conext is being appended to&lt;/param&gt;
        /// &lt;param name = &quot;action&quot;&gt;callback&lt;/param&gt;
        public void AttachMenuItemRegistrations( ref ContextMenu menuparent , Type type , Action&lt; Object , RoutedEventArgs &gt; action )
        {
            try
            {
                var newparent = menuparent as object;
                this.AttachToNewParent( ref newparent , type , action );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        /// &lt;summary&gt;
        ///   Asks the Context menu handler to append menu entries for a given context menu
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;menuparent&quot;&gt;Conext menu to add entries to&lt;/param&gt;
        /// &lt;param name = &quot;type&quot;&gt;Type of item that the conext is being appended to&lt;/param&gt;
        /// &lt;param name = &quot;action&quot;&gt;callback&lt;/param&gt;
        public void AttachMenuItemRegistrations( ref Menu menuparent , Type type , Action&lt; Object , RoutedEventArgs &gt; action )
        {
            try
            {
                var newparent = menuparent as object;
                this.AttachToNewParent( ref newparent , type , action );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        /// &lt;summary&gt;
        /// The call back mechanism
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;sender&quot;&gt;the meuu item clicked&lt;/param&gt;
        /// &lt;param name=&quot;theobject&quot;&gt;&lt;/param&gt;
        public void CallBack( MenuItem sender , object theobject )
        {
            try
            {
                foreach( var reg in this._registrations )
                {
                    if( sender == reg.MenuEntry )
                    {
                        reg.Action( theobject );
                    }
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Plugin registers for context menus that are on type
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;type&quot;&gt;type&lt;/param&gt;
        /// &lt;param name=&quot;item&quot;&gt;&lt;/param&gt;
        /// &lt;param name = &quot;action&quot;&gt;The call back mechanism&lt;/param&gt;
        public void RegisterContextMenuItem( Type type , MenuItem item , Action&lt; Object &gt; action )
        {
            try
            {
                item.Foreground = Brushes.Black;

                var entry = new Entry
                {
                    Action = action ,
                    Type = type ,
                    MenuEntry = item
                };

                if( this.CheckRegistrations( entry ) == false )
                {
                    this._registrations.Add( entry );
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Asks the Context menu handler to append menu entries for a given context menu
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;menuparent&quot;&gt;Conext menu to add entries to&lt;/param&gt;
        /// &lt;param name = &quot;type&quot;&gt;Type of item that the conext is being appended to&lt;/param&gt;
        /// &lt;param name = &quot;action&quot;&gt;callback&lt;/param&gt;
        public void AttachMenuItemRegistrations( ref MenuItem menuparent , Type type , Action&lt; Object , RoutedEventArgs &gt; action )
        {
            try
            {
                var newparent = menuparent as object;
                this.AttachToNewParent( ref newparent , type , action );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private bool CheckRegistrations( Entry entry )
        {
            foreach( var reg in this._registrations )
            {
                if( reg.Type == entry.Type &amp;&amp; reg.MenuEntry == entry.MenuEntry )
                {
                    return true;
                }
            }
            return false;
        }


        private void UnattachFromCurrentParent( int current )
        {
            if( this._registrations[ current ].MenuEntry.Parent != null )
            {
                var contextmenu = this._registrations[ current ].MenuEntry.Parent as ContextMenu;
                var menuitem = this._registrations[ current ].MenuEntry.Parent as MenuItem;
                var menu = this._registrations[ current ].MenuEntry.Parent as Menu;

                if( contextmenu != null )
                {
                    contextmenu.Items.Remove( this._registrations[ current ].MenuEntry );
                }

                if( menuitem != null )
                {
                    menuitem.Items.Remove( this._registrations[ current ].MenuEntry );
                }

                if( menu != null )
                {
                    menu.Items.Remove( this._registrations[ current ].MenuEntry );
                }

                this._registrations[ current ].MenuEntry.Click -= this._registrations[ current ].PrevHandler;
            }
        }


        private void AttachToNewParent( ref object menuparent , Type type , Action&lt; Object , RoutedEventArgs &gt; action )
        {
            try
            {
                for( var i = 0; i &lt; this._registrations.Count; i++ )
                {
                    if( this._registrations[ i ].Type != type )
                    {
                        continue;
                    }

                    this.UnattachFromCurrentParent( i );

                    this._registrations[ i ].PrevHandler = new RoutedEventHandler( action );
                    this._registrations[ i ].MenuEntry.Click += this._registrations[ i ].PrevHandler;

                    if( menuparent is Menu )
                    {
                        var parentMenu = menuparent as Menu;
                        parentMenu.Items.Add( this._registrations[ i ].MenuEntry );
                    }

                    if( menuparent is MenuItem )
                    {
                        var parentMenu = menuparent as MenuItem;
                        parentMenu.Items.Add( this._registrations[ i ].MenuEntry );
                    }

                    if( menuparent is ContextMenu )
                    {
                        var parentMenu = menuparent as ContextMenu;
                        parentMenu.Items.Add( this._registrations[ i ].MenuEntry );
                    }
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #endregion

        #region Nested type: Entry

        private class Entry
        {
            public Action&lt; Object &gt; Action;
            public MenuItem MenuEntry;
            public RoutedEventHandler PrevHandler;
            public Type Type;
        }

        #endregion
    }
}</pre></code><script type="text/javascript">
			applyranges('src215', RANGES_215)
		</script>
	</body>
</html>