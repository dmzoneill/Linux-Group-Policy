<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_342 = [
   [35,9,35,24,'dccv']
, [36,9,36,10,'dccv']
, [38,13,38,14,'dccv']
, [39,17,39,44,'dccv']
, [40,17,40,38,'dccv']
, [42,17,45,19,'dccv']
, [46,17,46,58,'dccv']
, [47,17,47,37,'dccv']
, [49,17,49,54,'dccv']
, [50,13,50,14,'dccv']
, [55,9,55,10,'dccv']
, [58,9,58,10,'dccv']
, [60,13,60,14,'dccv']
, [61,17,61,36,'dccv']
, [62,13,62,14,'dccv']
, [66,9,66,10,'dccv']
, [69,9,69,10,'dccv']
, [71,13,71,14,'dccv']
, [72,17,72,62,'dccv']
, [74,17,74,41,'dccv']
, [79,17,79,43,'dccv']
, [80,17,80,53,'dccv']
, [81,17,81,53,'dccv']
, [82,17,82,43,'dccv']
, [83,17,83,41,'dccv']
, [84,17,84,41,'dccv']
, [86,17,86,77,'dccv']
, [87,17,87,77,'dccv']
, [88,17,88,71,'dccv']
, [89,17,89,71,'dccv']
, [90,17,90,72,'dccv']
, [92,22,92,32,'dccv']
, [93,17,93,18,'dccv']
, [94,21,94,52,'dccv']
, [95,21,95,99,'dccv']
, [96,17,96,18,'dccv']
, [92,53,92,56,'dccv']
, [92,33,92,51,'dccv']
, [98,22,98,32,'dccv']
, [99,17,99,18,'dccv']
, [100,21,100,52,'dccv']
, [101,21,101,99,'dccv']
, [102,17,102,18,'dccv']
, [98,53,98,56,'dccv']
, [98,33,98,51,'dccv']
, [104,22,104,32,'dccv']
, [105,17,105,18,'dccv']
, [106,21,106,52,'dccv']
, [107,21,107,89,'dccv']
, [108,17,108,18,'dccv']
, [104,48,104,51,'dccv']
, [104,33,104,46,'dccv']
, [110,22,110,32,'dccv']
, [111,17,111,18,'dccv']
, [112,21,112,52,'dccv']
, [113,21,113,87,'dccv']
, [114,17,114,18,'dccv']
, [110,47,110,50,'dccv']
, [110,33,110,45,'dccv']
, [117,22,117,32,'dccv']
, [118,17,118,18,'dccv']
, [119,21,119,52,'dccv']
, [120,21,120,87,'dccv']
, [121,17,121,18,'dccv']
, [117,47,117,50,'dccv']
, [117,33,117,45,'dccv']
, [123,17,124,17,'dccv']
, [126,58,127,23,'dccv']
, [129,17,130,17,'dccv']
, [132,58,133,23,'dccv']
, [135,17,136,17,'dccv']
, [138,67,139,23,'dccv']
, [141,17,142,17,'dccv']
, [144,67,145,23,'dccv']
, [147,17,148,17,'dccv']
, [150,62,151,23,'dccv']
, [152,13,152,14,'dccv']
, [157,9,157,10,'dccv']
, [157,9,157,10,'dccv']
, [165,9,165,10,'dccv']
, [166,13,166,62,'dccv']
, [167,9,167,10,'dccv']
, [170,9,170,10,'dccv']
, [171,13,171,33,'dccv']
, [172,13,172,14,'dccv']
, [173,17,173,52,'dccv']
, [175,17,175,18,'dccv']
, [176,21,176,40,'dccv']
, [179,21,179,22,'dccv']
, [180,25,180,45,'dccv']
, [181,21,181,22,'dccv']
, [185,17,185,18,'dccv']
, [190,13,190,14,'dccv']
, [191,9,191,10,'dccv']
, [199,9,199,10,'dccv']
, [201,13,201,14,'dccv']
, [202,17,202,36,'dccv']
, [203,17,203,33,'dccv']
, [204,17,204,33,'dccv']
, [205,17,205,39,'dccv']
, [206,17,206,39,'dccv']
, [207,13,207,14,'dccv']
, [211,9,211,10,'dccv']
, [217,9,217,10,'dccv']
, [218,13,218,56,'dccv']
, [219,9,219,10,'dccv']
, [225,9,225,10,'dccv']
, [227,13,227,14,'dccv']
, [228,17,228,36,'dccv']
, [229,17,229,18,'dccv']
, [230,21,230,40,'dccv']
, [231,21,231,43,'dccv']
, [232,17,232,18,'dccv']
, [233,13,233,14,'dccv']
, [237,9,237,10,'dccv']
, [243,9,243,10,'dccv']
, [245,13,245,14,'dccv']
, [246,17,246,37,'dccv']
, [247,17,247,18,'dccv']
, [248,21,248,41,'dccv']
, [249,21,249,42,'dccv']
, [250,17,250,18,'dccv']
, [251,13,251,14,'dccv']
, [255,9,255,10,'dccv']
, [124,17,124,18,'dccv']
, [125,21,125,54,'dccv']
, [126,21,126,58,'dccv']
, [130,17,130,18,'dccv']
, [131,21,131,54,'dccv']
, [132,21,132,58,'dccv']
, [136,17,136,18,'dccv']
, [137,21,137,57,'dccv']
, [138,21,138,67,'dccv']
, [142,17,142,18,'dccv']
, [143,21,143,57,'dccv']
, [144,21,144,67,'dccv']
, [148,17,148,18,'dccv']
, [149,21,149,57,'dccv']
, [150,21,150,62,'dccv']
, [51,13,51,37,'dcuc']
, [52,13,52,14,'dcuc']
, [53,17,53,53,'dcuc']
, [54,13,54,14,'dcuc']
, [63,13,63,31,'dcuc']
, [64,13,64,14,'dcuc']
, [65,13,65,14,'dcuc']
, [75,17,75,18,'dcuc']
, [76,21,76,28,'dcuc']
, [153,13,153,37,'dcuc']
, [154,13,154,14,'dcuc']
, [155,17,155,53,'dcuc']
, [156,13,156,14,'dcuc']
, [182,21,182,39,'dcuc']
, [183,21,183,22,'dcuc']
, [184,21,184,22,'dcuc']
, [186,17,186,35,'dcuc']
, [187,17,187,18,'dcuc']
, [188,21,188,41,'dcuc']
, [189,17,189,18,'dcuc']
, [208,13,208,31,'dcuc']
, [209,13,209,14,'dcuc']
, [210,13,210,14,'dcuc']
, [234,13,234,31,'dcuc']
, [235,13,235,14,'dcuc']
, [236,13,236,14,'dcuc']
, [252,13,252,31,'dcuc']
, [253,13,253,14,'dcuc']
, [254,13,254,14,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src342" class="dotCoverSource"><pre>#region

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Timers;
using System.Windows.Controls;
using System.Windows.Input;
using System.Windows.Threading;
using LGP.Components.Factory;
using LGP.Components.Factory.Interfaces.Module;

#endregion

namespace LGP.Modules.Statistics
{
    /// &lt;summary&gt;
    ///   Interaction logic for Viewer.xaml
    /// &lt;/summary&gt;
    public partial class Viewer : IUserControl
    {
        private static UserControl _instance;
        private readonly Timer _timer;
        private List&lt; KeyValuePair&lt; string , int &gt; &gt; _cpu;
        private bool _enabled;
        private List&lt; KeyValuePair&lt; string , int &gt; &gt; _incoming;
        private List&lt; KeyValuePair&lt; string , int &gt; &gt; _outgoing;

        private List&lt; KeyValuePair&lt; string , int &gt; &gt; _rx;
        private List&lt; KeyValuePair&lt; string , int &gt; &gt; _tx;

        /// &lt;summary&gt;
        ///   Constructor
        /// &lt;/summary&gt;
        public Viewer()
        {
            try
            {
                this.InitializeComponent();
                this._enabled = true;

                this._timer = new Timer
                {
                    Interval = 1000
                };
                this._timer.Elapsed += this.TimerElapsed;
                this._timer.Start();

                Framework.ShutDown += this.Terminate;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        private void Terminate( object sender , CancelEventArgs args )
        {
            try
            {
                this._timer.Stop();
            }
            catch( Exception )
            {
            }
        }

        private void TimerElapsed( object sender , ElapsedEventArgs e )
        {
            try
            {
                var servers = Framework.Network.GetServers();

                if( servers.Count == 0 )
                {
                    return;
                }

                var server = servers[ 0 ];
                var incoming = server.GetIncoming();
                var outgoing = server.GetOutgoing();
                var cpu = server.GetCpu();
                var tx = server.GetTx();
                var rx = server.GetRx();

                this._incoming = new List&lt; KeyValuePair&lt; string , int &gt; &gt;();
                this._outgoing = new List&lt; KeyValuePair&lt; string , int &gt; &gt;();
                this._tx = new List&lt; KeyValuePair&lt; string , int &gt; &gt;();
                this._rx = new List&lt; KeyValuePair&lt; string , int &gt; &gt;();
                this._cpu = new List&lt; KeyValuePair&lt; string , int &gt; &gt;();

                for( var h = 0; h &lt; incoming.Count; h++ )
                {
                    var str = ( h + 1 ).ToString();
                    this._incoming.Add( new KeyValuePair&lt; string , int &gt;( str , incoming[ h ] ) );
                }

                for( var h = 0; h &lt; outgoing.Count; h++ )
                {
                    var str = ( h + 1 ).ToString();
                    this._outgoing.Add( new KeyValuePair&lt; string , int &gt;( str , outgoing[ h ] ) );
                }

                for( var h = 0; h &lt; cpu.Count; h++ )
                {
                    var str = ( h + 1 ).ToString();
                    this._cpu.Add( new KeyValuePair&lt; string , int &gt;( str , cpu[ h ] ) );
                }

                for( var h = 0; h &lt; tx.Count; h++ )
                {
                    var str = ( h + 1 ).ToString();
                    this._tx.Add( new KeyValuePair&lt; string , int &gt;( str , tx[ h ] ) );
                }


                for( var h = 0; h &lt; rx.Count; h++ )
                {
                    var str = ( h + 1 ).ToString();
                    this._rx.Add( new KeyValuePair&lt; string , int &gt;( str , rx[ h ] ) );
                }

                this.rxSeries.Dispatcher.BeginInvoke( DispatcherPriority.Normal , ( Action ) ( delegate
                {
                    this.rxSeries.ItemsSource = null;
                    this.rxSeries.ItemsSource = this._rx;
                } ) );

                this.txSeries.Dispatcher.BeginInvoke( DispatcherPriority.Normal , ( Action ) ( delegate
                {
                    this.txSeries.ItemsSource = null;
                    this.txSeries.ItemsSource = this._tx;
                } ) );

                this.LineSeries1.Dispatcher.BeginInvoke( DispatcherPriority.Normal , ( Action ) ( delegate
                {
                    this.LineSeries1.ItemsSource = null;
                    this.LineSeries1.ItemsSource = this._incoming;
                } ) );

                this.LineSeries2.Dispatcher.BeginInvoke( DispatcherPriority.Normal , ( Action ) ( delegate
                {
                    this.LineSeries2.ItemsSource = null;
                    this.LineSeries2.ItemsSource = this._outgoing;
                } ) );

                this.LineSeries3.Dispatcher.BeginInvoke( DispatcherPriority.Normal , ( Action ) ( delegate
                {
                    this.LineSeries3.ItemsSource = null;
                    this.LineSeries3.ItemsSource = this._cpu;
                } ) );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        /// &lt;summary&gt;
        ///   Returns this instance of the user control ( Singleton )
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Usercontrol Instance&lt;/returns&gt;
        public static UserControl GetInstance()
        {
            return _instance ?? ( _instance = new Viewer() );
        }

        private void UserControlKeyDown( object sender , System.Windows.Input.KeyEventArgs e )
        {
            if( e.Key == Key.R )
            {
                Console.WriteLine( @&quot;restarting&quot; );
                try
                {
                    this._timer.Stop();

                    try
                    {
                        this._timer.Start();
                    }
                    catch( Exception )
                    {
                    }
                }
                catch( Exception )
                {
                    this._timer.Start();
                }
            }
        }

        #region Implementation of IUserControl

        /// &lt;summary&gt;
        ///   Aks the UserControl to do some clean up!
        /// &lt;/summary&gt;
        public void Dispose()
        {
            try
            {
                this._timer.Stop();
                this._rx = null;
                this._tx = null;
                this._incoming = null;
                this._outgoing = null;
            }
            catch( Exception )
            {
            }
        }

        /// &lt;summary&gt;
        /// Asks the Usercontrol to refresh itself
        /// &lt;/summary&gt;
        public void Refresh()
        {
            this.Tag = Properties.Resources.Statistics;
        }

        /// &lt;summary&gt;
        /// When the control is no longer in focus, asks it to pause ( heavy duty non critical, ie threads updating graphs )
        /// &lt;/summary&gt;
        public void Pause()
        {
            try
            {
                if( this._enabled )
                {
                    this._timer.Stop();
                    this._enabled = false;
                }
            }
            catch( Exception )
            {
            }
        }

        /// &lt;summary&gt;
        /// When the tab comes back into focus, resume ( heavy duty non critical, ie threads updating graphs )
        /// &lt;/summary&gt;
        public void Resume()
        {
            try
            {
                if( !this._enabled )
                {
                    this._timer.Start();
                    this._enabled = true;
                }
            }
            catch( Exception )
            {
            }
        }

        #endregion
    }
}</pre></code><script type="text/javascript">
			applyranges('src342', RANGES_342)
		</script>
	</body>
</html>