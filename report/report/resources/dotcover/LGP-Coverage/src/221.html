<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_221 = [
   [27,9,27,10,'dccv']
, [29,13,29,14,'dccv']
, [30,17,30,108,'dccv']
, [31,17,31,104,'dccv']
, [32,13,32,14,'dccv']
, [37,9,37,10,'dccv']
, [23,9,23,51,'dccv']
, [42,9,42,31,'dccv']
, [43,9,43,10,'dccv']
, [45,13,45,14,'dccv']
, [46,17,46,44,'dccv']
, [47,13,47,14,'dccv']
, [52,9,52,10,'dccv']
, [23,9,23,51,'dccv']
, [60,9,60,62,'dccv']
, [61,9,61,10,'dccv']
, [63,13,63,14,'dccv']
, [64,17,64,44,'dccv']
, [66,17,66,44,'dccv']
, [67,17,67,47,'dccv']
, [68,17,68,47,'dccv']
, [70,17,70,51,'dccv']
, [71,17,74,19,'dccv']
, [76,17,76,141,'dccv']
, [79,17,79,72,'dccv']
, [80,17,80,18,'dccv']
, [81,21,81,98,'dccv']
, [82,21,82,44,'dccv']
, [83,21,83,65,'dccv']
, [84,21,84,43,'dccv']
, [85,21,85,38,'dccv']
, [86,17,86,18,'dccv']
, [91,13,91,14,'dccv']
, [96,9,96,10,'dccv']
, [106,9,106,10,'dccv']
, [108,13,108,14,'dccv']
, [109,17,110,17,'dccv']
, [115,18,115,21,'dccv']
, [116,17,116,64,'dccv']
, [117,17,117,44,'dccv']
, [118,17,118,32,'dccv']
, [119,17,119,30,'dccv']
, [120,13,120,14,'dccv']
, [125,9,125,10,'dccv']
, [130,9,130,10,'dccv']
, [132,13,132,14,'dccv']
, [133,17,133,34,'dccv']
, [135,22,135,32,'dccv']
, [136,17,136,18,'dccv']
, [137,21,137,37,'dccv']
, [138,21,138,73,'dccv']
, [139,21,139,77,'dccv']
, [140,21,140,43,'dccv']
, [141,17,141,18,'dccv']
, [135,47,135,50,'dccv']
, [135,33,135,45,'dccv']
, [142,17,142,39,'dccv']
, [149,9,149,10,'dccv']
, [152,9,152,10,'dccv']
, [154,13,154,14,'dccv']
, [155,17,155,84,'dccv']
, [157,17,160,19,'dccv']
, [162,17,165,19,'dccv']
, [166,17,166,104,'dccv']
, [167,17,167,53,'dccv']
, [168,17,168,74,'dccv']
, [170,17,170,49,'dccv']
, [171,17,171,28,'dccv']
, [172,13,172,14,'dccv']
, [177,9,177,10,'dccv']
, [181,9,181,10,'dccv']
, [183,13,183,14,'dccv']
, [184,17,184,36,'dccv']
, [186,17,186,52,'dccv']
, [188,17,188,84,'dccv']
, [191,17,194,19,'dccv']
, [196,17,199,19,'dccv']
, [200,17,200,104,'dccv']
, [202,17,202,54,'dccv']
, [204,17,204,74,'dccv']
, [206,17,206,51,'dccv']
, [207,17,207,29,'dccv']
, [208,13,208,14,'dccv']
, [213,9,213,10,'dccv']
, [217,9,217,10,'dccv']
, [218,13,218,26,'dccv']
, [219,9,219,10,'dccv']
, [110,17,110,18,'dccv']
, [111,21,111,68,'dccv']
, [112,21,112,30,'dccv']
, [113,21,113,53,'dccv']
, [113,82,113,83,'dccv']
, [114,21,114,38,'dccv']
, [115,17,115,18,'dccv']
, [113,53,113,82,'dccv']
, [33,13,33,37,'dcuc']
, [34,13,34,14,'dcuc']
, [35,17,35,53,'dcuc']
, [36,13,36,14,'dcuc']
, [48,13,48,37,'dcuc']
, [49,13,49,14,'dcuc']
, [50,17,50,53,'dcuc']
, [51,13,51,14,'dcuc']
, [88,17,88,18,'dcuc']
, [89,21,89,34,'dcuc']
, [90,17,90,18,'dcuc']
, [92,13,92,37,'dcuc']
, [93,13,93,14,'dcuc']
, [94,17,94,53,'dcuc']
, [95,13,95,14,'dcuc']
, [121,13,121,37,'dcuc']
, [122,13,122,14,'dcuc']
, [123,17,123,53,'dcuc']
, [124,13,124,14,'dcuc']
, [144,13,144,37,'dcuc']
, [145,13,145,14,'dcuc']
, [146,17,146,53,'dcuc']
, [147,17,147,28,'dcuc']
, [173,13,173,37,'dcuc']
, [174,13,174,14,'dcuc']
, [175,17,175,53,'dcuc']
, [176,13,176,14,'dcuc']
, [209,13,209,37,'dcuc']
, [210,13,210,14,'dcuc']
, [211,17,211,53,'dcuc']
, [212,13,212,14,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src221" class="dotCoverSource"><pre>#region

using System;
using System.Threading;
using System.Windows;
using System.Windows.Media;
using System.Windows.Media.Animation;
using System.Windows.Threading;
using LGP.Components.Factory;
using LGP.Components.Factory.Interfaces.Infrastructure;

#endregion

namespace LGP.Components.Notifications
{
    /// &lt;summary&gt;
    /// Interaction logic for Notifications.xaml
    /// &lt;/summary&gt;
    public partial class Notifications : INotification
    {
        private static readonly double InitialLeft;
        private static readonly double InitialTop;
        private readonly int _popopTimeout = 1000;


        static Notifications()
        {
            try
            {
                InitialLeft = ( Framework.ApplicationWindow.Width / 2 ) + Framework.ApplicationWindow.Left;
                InitialTop = Framework.ApplicationWindow.Top + Framework.ApplicationWindow.Height - 50;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Constructor
        /// &lt;/summary&gt;
        public Notifications()
        {
            try
            {
                this.InitializeComponent();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        /// &lt;summary&gt;
        ///   Constructor
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;message&quot;&gt;text to show&lt;/param&gt;
        /// &lt;param name = &quot;interval&quot;&gt;poup timeout&lt;/param&gt;
        public Notifications( string message , int interval )
        {
            try
            {
                this.InitializeComponent();

                this.ShowActivated = false;
                this.popupText.Text = message;
                this._popopTimeout = interval;

                var thread = Thread.CurrentThread;
                this.DataContext = new
                {
                    ThreadID = thread.ManagedThreadId
                };

                var typeface = new Typeface( new FontFamily( &quot;Segoe UI&quot; ) , FontStyles.Normal , FontWeights.Normal , FontStretches.Normal );

                GlyphTypeface glyphTypeface;
                if( typeface.TryGetGlyphTypeface( out glyphTypeface ) )
                {
                    var sizeWidth = MeasureTextWidth( glyphTypeface , 16 , this.popupText.Text );
                    this.Width = sizeWidth;
                    this.Left = InitialLeft - ( sizeWidth / 2 );
                    this.Top = InitialTop;
                    this.AnimateIn();
                }
                else
                {
                    this.Close();
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #region Implementation of INotifcation

        /// &lt;summary&gt;
        ///   Displays the popup for x microsecond
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;message&quot;&gt;the message to display&lt;/param&gt;
        /// &lt;param name = &quot;timeout&quot;&gt;microseonds&lt;/param&gt;
        public void Display( string message , int timeout )
        {
            try
            {
                var thread = new Thread( () =&gt;
                {
                    var w = new Notifications( message , timeout );
                    w.Show();
                    w.Closed += ( sender1 , e1 ) =&gt; w.Dispatcher.InvokeShutdown();
                    Dispatcher.Run();
                } );
                thread.SetApartmentState( ApartmentState.STA );
                thread.IsBackground = true;
                thread.Start();
                this.Close();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #endregion

        private static double MeasureTextWidth( GlyphTypeface glyphTypeface , double emSize , string s )
        {
            try
            {
                double width = 0;

                for( var i = 0; i &lt; s.Length; i++ )
                {
                    var ch = s[ i ];
                    var glyph = glyphTypeface.CharacterToGlyphMap[ ch ];
                    var advanceWidth = glyphTypeface.AdvanceWidths[ glyph ];
                    width += advanceWidth;
                }
                return width * emSize;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
                return 0.0;
            }
        }

        private void AnimateIn()
        {
            try
            {
                var duration = new Duration( new TimeSpan( 0 , 0 , 0 , 0 , 500 ) );

                var opacityAnimation = new DoubleAnimation
                {
                    Duration = duration , From = this.Opacity , To = 0.9
                };

                var sb = new Storyboard
                {
                    Duration = duration
                };
                Storyboard.SetTargetProperty( opacityAnimation , new PropertyPath( OpacityProperty ) );
                sb.Children.Add( opacityAnimation );
                Storyboard.SetTarget( opacityAnimation , this.LGPPopup );

                sb.Completed += this.AnimateOut;
                sb.Begin();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private void AnimateOut( object sender , EventArgs e )
        {
            try
            {
                this.Opacity = 0.9;

                Thread.Sleep( this._popopTimeout );

                var duration = new Duration( new TimeSpan( 0 , 0 , 0 , 1 , 500 ) );


                var opacityAnimation = new DoubleAnimation
                {
                    Duration = duration , From = 0.9 , To = 0.0
                };

                var sb1 = new Storyboard
                {
                    Duration = duration
                };
                Storyboard.SetTargetProperty( opacityAnimation , new PropertyPath( OpacityProperty ) );

                sb1.Children.Add( opacityAnimation );

                Storyboard.SetTarget( opacityAnimation , this.LGPPopup );

                sb1.Completed += this.CloseWindow;
                sb1.Begin();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private void CloseWindow( object sender , EventArgs e )
        {
            this.Close();
        }
    }
}</pre></code><script type="text/javascript">
			applyranges('src221', RANGES_221)
		</script>
	</body>
</html>