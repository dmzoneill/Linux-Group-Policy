<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_9 = [
   [30,9,30,26,'dccv']
, [31,9,31,10,'dccv']
, [33,13,33,14,'dccv']
, [34,17,34,44,'dccv']
, [35,17,35,32,'dccv']
, [36,13,36,14,'dccv']
, [41,9,41,10,'dccv']
, [48,9,48,51,'dccv']
, [49,9,49,10,'dccv']
, [51,13,51,14,'dccv']
, [52,17,52,44,'dccv']
, [53,17,53,32,'dccv']
, [54,17,54,57,'dccv']
, [55,13,55,14,'dccv']
, [60,9,60,10,'dccv']
, [64,9,64,10,'dccv']
, [66,13,66,14,'dccv']
, [67,17,67,24,'dccv']
, [67,41,67,55,'dccv']
, [67,26,67,37,'dccv']
, [68,17,68,18,'dccv']
, [69,21,69,85,'dccv']
, [71,21,71,53,'dccv']
, [72,21,72,22,'dccv']
, [73,25,73,34,'dccv']
, [76,21,76,28,'dccv']
, [76,42,76,53,'dccv']
, [76,30,76,38,'dccv']
, [77,21,77,22,'dccv']
, [78,25,78,62,'dccv']
, [80,25,80,85,'dccv']
, [85,25,85,48,'dccv']
, [86,25,86,31,'dccv']
, [76,39,76,41,'dccv']
, [88,17,88,18,'dccv']
, [67,38,67,40,'dccv']
, [89,13,89,14,'dccv']
, [94,9,94,10,'dccv']
, [98,9,98,10,'dccv']
, [100,13,100,14,'dccv']
, [101,17,104,19,'dccv']
, [106,17,106,64,'dccv']
, [107,17,107,58,'dccv']
, [108,17,108,60,'dccv']
, [109,17,109,46,'dccv']
, [111,17,111,106,'dccv']
, [113,17,113,24,'dccv']
, [113,41,113,67,'dccv']
, [113,26,113,37,'dccv']
, [114,17,114,18,'dccv']
, [116,21,116,22,'dccv']
, [117,25,117,104,'dccv']
, [118,25,118,70,'dccv']
, [119,25,119,50,'dccv']
, [120,21,120,22,'dccv']
, [125,17,125,18,'dccv']
, [113,38,113,40,'dccv']
, [127,17,127,51,'dccv']
, [128,17,128,49,'dccv']
, [129,17,129,173,'dccv']
, [131,17,131,38,'dccv']
, [132,13,132,14,'dccv']
, [137,9,137,10,'dccv']
, [141,9,141,10,'dccv']
, [143,13,143,14,'dccv']
, [144,17,144,24,'dccv']
, [144,41,144,55,'dccv']
, [144,26,144,37,'dccv']
, [145,17,145,18,'dccv']
, [146,21,146,58,'dccv']
, [147,21,147,34,'dccv']
, [148,17,148,18,'dccv']
, [144,38,144,40,'dccv']
, [149,17,149,30,'dccv']
, [150,13,150,14,'dccv']
, [155,9,155,10,'dccv']
, [179,9,179,10,'dccv']
, [180,13,180,27,'dccv']
, [181,13,181,41,'dccv']
, [184,13,184,14,'dccv']
, [185,17,185,63,'dccv']
, [187,17,187,42,'dccv']
, [188,17,188,18,'dccv']
, [189,21,189,46,'dccv']
, [190,17,190,18,'dccv']
, [192,17,192,41,'dccv']
, [193,17,193,25,'dccv']
, [194,13,194,14,'dccv']
, [183,13,183,33,'dccv']
, [197,13,197,23,'dccv']
, [198,13,198,37,'dccv']
, [201,13,201,14,'dccv']
, [202,17,202,49,'dccv']
, [203,17,203,40,'dccv']
, [204,17,204,51,'dccv']
, [206,17,206,46,'dccv']
, [207,17,207,18,'dccv']
, [208,21,208,83,'dccv']
, [210,26,210,36,'dccv']
, [211,21,211,22,'dccv']
, [212,25,212,57,'dccv']
, [213,25,213,67,'dccv']
, [215,25,215,68,'dccv']
, [216,25,216,26,'dccv']
, [217,29,217,56,'dccv']
, [218,25,218,26,'dccv']
, [219,21,219,22,'dccv']
, [210,46,210,49,'dccv']
, [210,37,210,44,'dccv']
, [220,17,220,18,'dccv']
, [222,17,222,25,'dccv']
, [223,13,223,14,'dccv']
, [200,13,200,33,'dccv']
, [225,13,225,23,'dccv']
, [226,13,226,37,'dccv']
, [229,13,229,14,'dccv']
, [230,17,230,63,'dccv']
, [232,17,232,43,'dccv']
, [233,17,233,18,'dccv']
, [234,21,234,70,'dccv']
, [235,17,235,18,'dccv']
, [237,17,237,25,'dccv']
, [238,13,238,14,'dccv']
, [228,13,228,33,'dccv']
, [239,9,239,10,'dccv']
, [243,9,243,10,'dccv']
, [244,13,244,70,'dccv']
, [246,13,246,41,'dccv']
, [247,13,247,14,'dccv']
, [248,17,248,45,'dccv']
, [249,13,249,14,'dccv']
, [251,13,251,49,'dccv']
, [252,13,252,14,'dccv']
, [253,17,256,19,'dccv']
, [259,17,263,19,'dccv']
, [265,17,265,109,'dccv']
, [267,17,267,99,'dccv']
, [268,17,268,36,'dccv']
, [269,17,269,35,'dccv']
, [271,17,271,43,'dccv']
, [272,17,272,45,'dccv']
, [274,17,274,37,'dccv']
, [276,17,276,41,'dccv']
, [277,13,277,14,'dccv']
, [278,9,278,10,'dccv']
, [282,9,282,10,'dccv']
, [283,18,283,28,'dccv']
, [284,13,284,14,'dccv']
, [285,17,285,59,'dccv']
, [287,17,287,49,'dccv']
, [288,17,288,18,'dccv']
, [289,21,289,33,'dccv']
, [291,13,291,14,'dccv']
, [283,52,283,55,'dccv']
, [283,29,283,50,'dccv']
, [293,13,293,26,'dccv']
, [294,9,294,10,'dccv']
, [298,9,298,10,'dccv']
, [300,13,300,14,'dccv']
, [301,17,304,19,'dccv']
, [307,17,311,19,'dccv']
, [313,17,313,80,'dccv']
, [315,17,315,44,'dccv']
, [316,17,316,36,'dccv']
, [317,17,317,35,'dccv']
, [319,17,319,43,'dccv']
, [320,17,320,45,'dccv']
, [322,17,322,37,'dccv']
, [324,17,324,41,'dccv']
, [325,13,325,14,'dccv']
, [330,9,330,10,'dccv']
, [334,9,334,10,'dccv']
, [336,13,336,14,'dccv']
, [337,17,340,19,'dccv']
, [343,17,347,19,'dccv']
, [349,17,349,68,'dccv']
, [351,17,351,36,'dccv']
, [352,17,352,35,'dccv']
, [354,17,354,43,'dccv']
, [355,17,355,45,'dccv']
, [357,17,357,37,'dccv']
, [359,17,359,41,'dccv']
, [360,13,360,14,'dccv']
, [365,9,365,10,'dccv']
, [368,9,368,10,'dccv']
, [370,13,370,14,'dccv']
, [371,17,371,80,'dccv']
, [372,17,372,43,'dccv']
, [373,17,373,18,'dccv']
, [374,21,374,59,'dccv']
, [376,21,376,28,'dccv']
, [376,45,376,59,'dccv']
, [376,30,376,41,'dccv']
, [377,21,377,22,'dccv']
, [378,25,378,61,'dccv']
, [379,25,379,67,'dccv']
, [380,25,380,26,'dccv']
, [381,29,381,70,'dccv']
, [382,29,382,58,'dccv']
, [383,29,383,79,'dccv']
, [384,29,384,71,'dccv']
, [386,29,386,69,'dccv']
, [387,29,387,30,'dccv']
, [388,33,388,88,'dccv']
, [389,29,389,30,'dccv']
, [390,29,390,66,'dccv']
, [391,25,391,26,'dccv']
, [392,21,392,22,'dccv']
, [376,42,376,44,'dccv']
, [393,17,393,18,'dccv']
, [394,13,394,14,'dccv']
, [399,9,399,10,'dccv']
, [407,9,407,10,'dccv']
, [408,13,408,28,'dccv']
, [409,13,409,47,'dccv']
, [410,9,410,10,'dccv']
, [37,13,37,37,'dcuc']
, [38,13,38,14,'dcuc']
, [39,17,39,53,'dcuc']
, [40,13,40,14,'dcuc']
, [56,13,56,37,'dcuc']
, [57,13,57,14,'dcuc']
, [58,17,58,53,'dcuc']
, [59,13,59,14,'dcuc']
, [81,25,81,26,'dcuc']
, [82,29,82,38,'dcuc']
, [90,13,90,37,'dcuc']
, [91,13,91,14,'dcuc']
, [92,17,92,53,'dcuc']
, [93,13,93,14,'dcuc']
, [121,21,121,45,'dcuc']
, [122,21,122,22,'dcuc']
, [123,25,123,61,'dcuc']
, [124,21,124,22,'dcuc']
, [133,13,133,37,'dcuc']
, [134,13,134,14,'dcuc']
, [135,17,135,53,'dcuc']
, [136,13,136,14,'dcuc']
, [151,13,151,37,'dcuc']
, [152,13,152,14,'dcuc']
, [153,17,153,53,'dcuc']
, [154,13,154,14,'dcuc']
, [164,9,164,10,'dcuc']
, [166,13,166,14,'dcuc']
, [167,17,167,47,'dcuc']
, [168,17,168,33,'dcuc']
, [169,13,169,14,'dcuc']
, [170,13,170,37,'dcuc']
, [171,13,171,14,'dcuc']
, [172,17,172,53,'dcuc']
, [173,13,173,14,'dcuc']
, [174,13,174,41,'dcuc']
, [175,9,175,10,'dcuc']
, [326,13,326,37,'dcuc']
, [327,13,327,14,'dcuc']
, [328,17,328,53,'dcuc']
, [329,13,329,14,'dcuc']
, [361,13,361,37,'dcuc']
, [362,13,362,14,'dcuc']
, [363,17,363,53,'dcuc']
, [364,13,364,14,'dcuc']
, [395,13,395,37,'dcuc']
, [396,13,396,14,'dcuc']
, [397,17,397,53,'dcuc']
, [398,13,398,14,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src9" class="dotCoverSource"><pre>#region

using System;
using System.Collections.Generic;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using LGP.Components.Factory;
using LGP.Components.Factory.Interfaces.Component;
using LGP.Components.Factory.Interfaces.Module;
using LGP.Components.Factory.Publishers.Events;

#endregion

namespace LGP.Controls
{
    /// &lt;summary&gt;
    ///   Interaction logic for Settings.xaml
    /// &lt;/summary&gt;
    public partial class Settings : ISettings
    {
        private List&lt; UserControl &gt; _controls;
        private List&lt; TreeViewItem &gt; _items;

        /// &lt;summary&gt;
        ///   Constructor
        /// &lt;/summary&gt;
        public Settings()
        {
            try
            {
                this.InitializeComponent();
                this.Prepare();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        /// &lt;summary&gt;
        /// Constructor
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;tevent&quot;&gt;PreferencesEvent&lt;/param&gt;
        public Settings( PreferencesEvent tevent )
        {
            try
            {
                this.InitializeComponent();
                this.Prepare();
                this.SelectPreferencesControl( tevent );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private void SelectPreferencesControl( PreferencesEvent tevent )
        {
            try
            {
                foreach( var control in this._controls )
                {
                    var controltype = ( ( IPreferences ) control ).GetControlType();

                    if( controltype != tevent.Type )
                    {
                        continue;
                    }

                    foreach( var item in this._items )
                    {
                        var ns = control.GetType().Namespace;

                        if( ns == null || ns.CompareTo( item.Tag.ToString() ) != 0 )
                        {
                            continue;
                        }

                        item.IsSelected = true;
                        break;
                    }
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private void Prepare()
        {
            try
            {
                var color = new Color
                {
                    A = 100 , B = 255 , G = 255 , R = 255
                };

                this.Background = new SolidColorBrush( color );
                this._items = new List&lt; TreeViewItem &gt;();
                this._controls = new List&lt; UserControl &gt;();
                this.treeView1.Items.Clear();

                this.dragBar.PreviewMouseLeftButtonDown += this.ChromeLessWindowSpaceMouseLeftButtonDown;

                foreach( var pVisual in Framework.PreferencesPanes )
                {
                    try
                    {
                        var module = ( IPreferences ) Framework.LibraryHandler.CreateObject( pVisual );
                        this._controls.Add( ( UserControl ) module );
                        this.AddOption( module );
                    }
                    catch( Exception error )
                    {
                        Framework.EventBus.Publish( error );
                    }
                }

                var thisprefs = new Preferences();
                this._controls.Add( thisprefs );
                this.AddOption( thisprefs , thisprefs.GetType().Namespace , thisprefs.GetName() , Framework.Images.ConvertBitmapToImage( Properties.Images.lgpico1 , 14 ) );

                this.OrganizeNodes();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private void CloseButtonClick( object sender , RoutedEventArgs e )
        {
            try
            {
                foreach( var control in this._controls )
                {
                    var prefs = ( IPreferences ) control;
                    prefs.Save();
                }
                this.Close();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        /// &lt;summary&gt;
        ///   Title bar click event handler
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;sender&quot;&gt;The object that raised the click event&lt;/param&gt;
        /// &lt;param name = &quot;e&quot;&gt;Event arguments associated with the event&lt;/param&gt;
        private void ChromeLessWindowSpaceMouseLeftButtonDown( object sender , MouseButtonEventArgs e )
        {
            try
            {
                this.Cursor = Cursors.SizeAll;
                this.DragMove();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
            this.Cursor = Cursors.Arrow;
        }


        private void OrganizeNodes()
        {
            var start = 0;
            var end = this._items.Count;

            while( start &lt; end )
            {
                var tag = this._items[ start ].Tag.ToString();

                if( tag.Contains( &quot;.&quot; ) )
                {
                    this.CheckParents( tag );
                }

                end = this._items.Count;
                start++;
            }


            start = 0;
            end = this._items.Count;

            while( start &lt; end )
            {
                var item = this._items[ start ];
                item.IsExpanded = true;
                var itemTag = item.Tag.ToString();

                if( itemTag.Contains( &quot;.&quot; ) )
                {
                    itemTag = itemTag.Substring( 0 , itemTag.LastIndexOf( &quot;.&quot; ) );

                    for( var j = 0; j &lt; end; j++ )
                    {
                        var iteritem = this._items[ j ];
                        var iteritemTag = iteritem.Tag.ToString();

                        if( itemTag.CompareTo( iteritemTag ) == 0 )
                        {
                            iteritem.Items.Add( item );
                        }
                    }
                }

                start++;
            }

            start = 0;
            end = this._items.Count;

            while( start &lt; end )
            {
                var tag = this._items[ start ].Tag.ToString();

                if( !tag.Contains( &quot;.&quot; ) )
                {
                    this.treeView1.Items.Add( this._items[ start ] );
                }

                start++;
            }
        }


        private void CheckParents( string tag )
        {
            var parent = tag.Substring( 0 , tag.LastIndexOf( &quot;.&quot; ) );

            if( parent.Contains( &quot;.&quot; ) )
            {
                this.CheckParents( parent );
            }

            if( this.Exists( parent ) == false )
            {
                var item = new TreeViewItem
                {
                    Tag = parent
                };


                var panel = new StackPanel
                {
                    Orientation = Orientation.Horizontal ,
                    Margin = new Thickness( 2 )
                };

                var block = new TextBlock( new Run( &quot; &quot; + parent.Substring( parent.IndexOf( &quot;.&quot; ) + 1 ) ) );

                var img = Framework.Images.ConvertBitmapToImage( Properties.Images.lgpico1 , 14 );
                img.MaxHeight = 14;
                img.MaxWidth = 14;

                panel.Children.Add( img );
                panel.Children.Add( block );

                item.Header = panel;

                this._items.Add( item );
            }
        }


        private bool Exists( string name )
        {
            for( var y = 0; y &lt; this._items.Count; y++ )
            {
                var tag = this._items[ y ].Tag.ToString();

                if( tag.CompareTo( name ) == 0 )
                {
                    return true;
                }
            }

            return false;
        }


        private void AddOption( IPreferences module )
        {
            try
            {
                var item = new TreeViewItem
                {
                    Tag = module.GetType().Namespace
                };


                var panel = new StackPanel
                {
                    Orientation = Orientation.Horizontal ,
                    Margin = new Thickness( 2 )
                };

                var block = new TextBlock( new Run( &quot; &quot; + module.GetName() ) );

                var img = module.GetIcon();
                img.MaxHeight = 14;
                img.MaxWidth = 14;

                panel.Children.Add( img );
                panel.Children.Add( block );

                item.Header = panel;

                this._items.Add( item );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private void AddOption( IPreferences module , string mnamespace , string name , Image img )
        {
            try
            {
                var item = new TreeViewItem
                {
                    Tag = mnamespace
                };


                var panel = new StackPanel
                {
                    Orientation = Orientation.Horizontal ,
                    Margin = new Thickness( 2 )
                };

                var block = new TextBlock( new Run( &quot; &quot; + name ) );

                img.MaxHeight = 14;
                img.MaxWidth = 14;

                panel.Children.Add( img );
                panel.Children.Add( block );

                item.Header = panel;

                this._items.Add( item );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        private void TreeView1SelectedItemChanged( object sender , RoutedPropertyChangedEventArgs&lt; object &gt; e )
        {
            try
            {
                var treeviewitem = this.treeView1.SelectedItem as TreeViewItem;
                if( treeviewitem != null )
                {
                    var tag = treeviewitem.Tag.ToString();

                    foreach( var control in this._controls )
                    {
                        var s = control.GetType().Namespace;
                        if( s != null &amp;&amp; s.CompareTo( tag ) == 0 )
                        {
                            control.Background = Brushes.Transparent;
                            this.prefsName.Content = tag;
                            control.VerticalAlignment = VerticalAlignment.Top;
                            ( ( IPreferences ) control ).Load( this );

                            if( this.paneContainer.Content != null )
                            {
                                ( ( IPreferences ) this.paneContainer.Content ).Save();
                            }
                            this.paneContainer.Content = control;
                        }
                    }
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #region Implementation of ISettings

        /// &lt;summary&gt;
        /// Ask the settings window to refresh itself
        /// &lt;/summary&gt;
        public void Refresh()
        {
            this.Prepare();
            Framework.Panels.UpdateTabNames();
        }

        #endregion
    }
}</pre></code><script type="text/javascript">
			applyranges('src9', RANGES_9)
		</script>
	</body>
</html>