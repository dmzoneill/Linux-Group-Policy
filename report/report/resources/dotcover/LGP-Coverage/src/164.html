<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_164 = [
   [19,9,19,10,'dccv']
, [20,13,20,47,'dccv']
, [23,13,23,14,'dccv']
, [24,17,24,79,'dccv']
, [26,17,26,64,'dccv']
, [31,17,31,65,'dccv']
, [33,17,33,50,'dccv']
, [35,17,35,50,'dccv']
, [40,17,40,24,'dccv']
, [40,41,40,57,'dccv']
, [40,26,40,37,'dccv']
, [41,17,41,18,'dccv']
, [42,21,42,50,'dccv']
, [43,21,43,53,'dccv']
, [44,21,44,63,'dccv']
, [45,21,45,65,'dccv']
, [47,21,47,75,'dccv']
, [49,21,49,45,'dccv']
, [50,17,50,18,'dccv']
, [40,38,40,40,'dccv']
, [51,13,51,14,'dccv']
, [56,9,56,10,'dccv']
, [68,9,68,10,'dccv']
, [70,13,70,14,'dccv']
, [71,17,71,39,'dccv']
, [76,22,76,32,'dccv']
, [77,17,77,18,'dccv']
, [78,21,78,114,'dccv']
, [82,17,82,18,'dccv']
, [76,53,76,56,'dccv']
, [76,33,76,51,'dccv']
, [84,17,84,138,'dccv']
, [86,17,86,64,'dccv']
, [91,17,91,59,'dccv']
, [93,17,93,135,'dccv']
, [95,17,95,66,'dccv']
, [97,17,97,51,'dccv']
, [98,17,98,50,'dccv']
, [99,17,99,46,'dccv']
, [101,17,101,72,'dccv']
, [102,17,102,41,'dccv']
, [104,17,104,55,'dccv']
, [111,9,111,10,'dccv']
, [256,9,256,10,'dccv']
, [257,13,257,48,'dccv']
, [259,13,259,14,'dccv']
, [260,17,260,39,'dccv']
, [261,17,261,18,'dccv']
, [262,21,262,43,'dccv']
, [263,17,263,18,'dccv']
, [265,22,265,32,'dccv']
, [266,17,266,18,'dccv']
, [267,21,267,61,'dccv']
, [268,21,268,22,'dccv']
, [269,25,269,52,'dccv']
, [270,21,270,22,'dccv']
, [271,17,271,18,'dccv']
, [265,53,265,56,'dccv']
, [265,33,265,51,'dccv']
, [273,17,273,30,'dccv']
, [280,9,280,10,'dccv']
, [287,9,287,10,'dccv']
, [289,13,289,14,'dccv']
, [290,17,290,39,'dccv']
, [294,13,294,14,'dccv']
, [299,13,299,29,'dccv']
, [300,9,300,10,'dccv']
, [27,17,27,18,'dcuc']
, [28,21,28,28,'dcuc']
, [36,17,36,18,'dcuc']
, [37,21,37,28,'dcuc']
, [52,13,52,37,'dcuc']
, [53,13,53,14,'dcuc']
, [54,17,54,53,'dcuc']
, [55,13,55,14,'dcuc']
, [72,17,72,18,'dcuc']
, [73,21,73,43,'dcuc']
, [74,17,74,18,'dcuc']
, [79,21,79,22,'dcuc']
, [80,25,80,46,'dcuc']
, [87,17,87,18,'dcuc']
, [88,21,88,33,'dcuc']
, [106,13,106,37,'dcuc']
, [107,13,107,14,'dcuc']
, [108,17,108,53,'dcuc']
, [109,17,109,29,'dcuc']
, [119,9,119,10,'dcuc']
, [121,13,121,14,'dcuc']
, [122,17,122,39,'dcuc']
, [123,17,123,18,'dcuc']
, [124,21,124,43,'dcuc']
, [125,17,125,18,'dcuc']
, [127,22,127,32,'dcuc']
, [128,17,128,18,'dcuc']
, [129,21,129,109,'dcuc']
, [130,21,130,22,'dcuc']
, [131,25,131,48,'dcuc']
, [132,21,132,22,'dcuc']
, [133,17,133,18,'dcuc']
, [127,53,127,56,'dcuc']
, [127,33,127,51,'dcuc']
, [135,17,135,131,'dcuc']
, [137,17,137,64,'dcuc']
, [138,17,138,18,'dcuc']
, [139,21,139,28,'dcuc']
, [142,17,142,59,'dcuc']
, [143,13,143,14,'dcuc']
, [144,13,144,37,'dcuc']
, [145,13,145,14,'dcuc']
, [146,17,146,53,'dcuc']
, [147,13,147,14,'dcuc']
, [148,9,148,10,'dcuc']
, [155,9,155,10,'dcuc']
, [157,13,157,14,'dcuc']
, [158,17,158,39,'dcuc']
, [159,17,159,18,'dcuc']
, [160,21,160,43,'dcuc']
, [161,17,161,18,'dcuc']
, [163,22,163,32,'dcuc']
, [164,17,164,18,'dcuc']
, [165,21,165,61,'dcuc']
, [166,21,166,22,'dcuc']
, [167,25,167,48,'dcuc']
, [168,21,168,22,'dcuc']
, [169,17,169,18,'dcuc']
, [163,53,163,56,'dcuc']
, [163,33,163,51,'dcuc']
, [171,17,171,101,'dcuc']
, [173,17,173,64,'dcuc']
, [174,17,174,18,'dcuc']
, [175,21,175,28,'dcuc']
, [178,17,178,59,'dcuc']
, [179,13,179,14,'dcuc']
, [180,13,180,37,'dcuc']
, [181,13,181,14,'dcuc']
, [182,17,182,53,'dcuc']
, [183,13,183,14,'dcuc']
, [184,9,184,10,'dcuc']
, [193,9,193,10,'dcuc']
, [195,13,195,14,'dcuc']
, [196,17,196,39,'dcuc']
, [197,17,197,18,'dcuc']
, [198,21,198,43,'dcuc']
, [199,17,199,18,'dcuc']
, [201,22,201,32,'dcuc']
, [202,17,202,18,'dcuc']
, [203,21,203,109,'dcuc']
, [204,21,204,22,'dcuc']
, [205,25,205,46,'dcuc']
, [207,17,207,18,'dcuc']
, [201,53,201,56,'dcuc']
, [201,33,201,51,'dcuc']
, [209,17,209,29,'dcuc']
, [211,13,211,37,'dcuc']
, [212,13,212,14,'dcuc']
, [213,17,213,53,'dcuc']
, [214,17,214,29,'dcuc']
, [216,9,216,10,'dcuc']
, [225,9,225,10,'dcuc']
, [227,13,227,14,'dcuc']
, [228,17,228,39,'dcuc']
, [229,17,229,18,'dcuc']
, [230,21,230,43,'dcuc']
, [231,17,231,18,'dcuc']
, [233,22,233,32,'dcuc']
, [234,17,234,18,'dcuc']
, [235,21,235,92,'dcuc']
, [236,21,236,22,'dcuc']
, [237,25,237,46,'dcuc']
, [239,17,239,18,'dcuc']
, [233,53,233,56,'dcuc']
, [233,33,233,51,'dcuc']
, [241,17,241,29,'dcuc']
, [243,13,243,37,'dcuc']
, [244,13,244,14,'dcuc']
, [245,17,245,53,'dcuc']
, [246,17,246,29,'dcuc']
, [248,9,248,10,'dcuc']
, [275,13,275,37,'dcuc']
, [276,13,276,14,'dcuc']
, [277,17,277,53,'dcuc']
, [278,17,278,30,'dcuc']
, [291,17,291,18,'dcuc']
, [292,21,292,43,'dcuc']
, [293,17,293,18,'dcuc']
, [295,13,295,37,'dcuc']
, [296,13,296,14,'dcuc']
, [297,17,297,53,'dcuc']
, [298,13,298,14,'dcuc']
, [306,9,306,10,'dcuc']
, [308,13,308,14,'dcuc']
, [309,17,309,79,'dcuc']
, [311,17,311,64,'dcuc']
, [312,17,312,18,'dcuc']
, [313,21,313,28,'dcuc']
, [316,17,316,65,'dcuc']
, [318,17,318,50,'dcuc']
, [320,17,320,50,'dcuc']
, [321,17,321,18,'dcuc']
, [322,21,322,28,'dcuc']
, [325,17,325,24,'dcuc']
, [325,41,325,57,'dcuc']
, [325,26,325,37,'dcuc']
, [326,17,326,18,'dcuc']
, [327,21,327,50,'dcuc']
, [328,21,328,53,'dcuc']
, [329,21,329,63,'dcuc']
, [330,21,330,65,'dcuc']
, [332,21,332,43,'dcuc']
, [334,26,334,36,'dcuc']
, [335,21,335,22,'dcuc']
, [336,25,336,58,'dcuc']
, [337,25,337,26,'dcuc']
, [338,29,338,38,'dcuc']
, [341,25,341,44,'dcuc']
, [342,25,342,31,'dcuc']
, [334,57,334,60,'dcuc']
, [334,37,334,55,'dcuc']
, [345,21,345,38,'dcuc']
, [346,21,346,22,'dcuc']
, [347,25,347,34,'dcuc']
, [350,21,350,75,'dcuc']
, [352,21,352,45,'dcuc']
, [353,17,353,18,'dcuc']
, [325,38,325,40,'dcuc']
, [354,13,354,14,'dcuc']
, [355,13,355,37,'dcuc']
, [356,13,356,14,'dcuc']
, [357,17,357,53,'dcuc']
, [358,13,358,14,'dcuc']
, [359,9,359,10,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src164" class="dotCoverSource"><pre>#region

using System;
using System.Collections.Generic;
using System.Data;
using LGP.Components.Database.Entities;
using LGP.Components.Factory;
using LGP.Components.Factory.Interfaces.Database;

#endregion

namespace LGP.Components.Database.Gateways
{
    internal class GrammerGateway : IGrammerGateway
    {
        private static List&lt; IGrammer &gt; _grammer;

        private static void BuildGrammerListing()
        {
            _grammer = new List&lt; IGrammer &gt;();

            try
            {
                var sql = string.Format( &quot;select * from moduleGrammerWords&quot; );

                if( Framework.Database.IsConnected() == false )
                {
                    return;
                }

                var ds = Framework.Database.ExecuteQuery( sql );

                var clientTable = ds.Tables[ 0 ];

                if( clientTable.Rows.Count == 0 )
                {
                    return;
                }

                foreach( DataRow row in clientTable.Rows )
                {
                    var id = ( int ) row[ &quot;id&quot; ];
                    var mid = ( int ) row[ &quot;m_id&quot; ];
                    var gkey = ( string ) row[ &quot;grammerkey&quot; ];
                    var gvalue = ( string ) row[ &quot;grammerval&quot; ];

                    var grammer = new Grammer( id , mid , gkey , gvalue );

                    _grammer.Add( grammer );
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #region Implementation of IGrammerGateway

        /// &lt;summary&gt;
        ///   Adds a grammer given a moduleid or returns existing Grammer
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;moduleId&quot;&gt;int&lt;/param&gt;
        /// &lt;param name = &quot;key&quot;&gt;string&lt;/param&gt;
        /// &lt;param name = &quot;val&quot;&gt;string&lt;/param&gt;
        /// &lt;returns&gt;IGrammer&lt;/returns&gt;
        public IGrammer CreateGrammer( int moduleId , string key , string val )
        {
            try
            {
                if( _grammer == null )
                {
                    BuildGrammerListing();
                }

                for( var y = 0; y &lt; _grammer.Count; y++ )
                {
                    if( _grammer[ y ].GetModuleId() == moduleId &amp;&amp; _grammer[ y ].GetKey().CompareTo( key ) == 0 )
                    {
                        return _grammer[ y ];
                    }
                }

                var sql = string.Format( &quot;insert into moduleGrammerWords values( null , &#39;{0}&#39; , &#39;{1}&#39; ,&#39;{2}&#39; )&quot; , moduleId , key , val );

                if( Framework.Database.IsConnected() == false )
                {
                    return null;
                }

                Framework.Database.ExecuteNonQuery( sql );

                var sql2 = string.Format( &quot;select * from moduleGrammerWords where id = ( select MAX( id ) from moduleGrammerWords)&quot; );

                var ds = Framework.Database.ExecuteQuery( sql2 );

                var grammerTable = ds.Tables[ 0 ];
                var row = grammerTable.Rows[ 0 ];
                var id = ( int ) row[ &quot;id&quot; ];

                var grammer = new Grammer( id , moduleId , key , val );
                _grammer.Add( grammer );

                return _grammer[ _grammer.Count - 1 ];
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
                return null;
            }
        }

        /// &lt;summary&gt;
        ///   Deletes a grammer entry given key and moduleid
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;mid&quot;&gt;int&lt;/param&gt;
        /// &lt;param name = &quot;key&quot;&gt;string&lt;/param&gt;
        public void DeleteGrammer( int mid , string key )
        {
            try
            {
                if( _grammer == null )
                {
                    BuildGrammerListing();
                }

                for( var y = 0; y &lt; _grammer.Count; y++ )
                {
                    if( _grammer[ y ].GetModuleId() == mid &amp;&amp; _grammer[ y ].GetKey().CompareTo( key ) == 0 )
                    {
                        _grammer.RemoveAt( y );
                    }
                }

                var sql = string.Format( &quot;delete from moduleGrammerWords where m_id= &#39;{0}&#39; and grammerkey = &#39;{1}&#39; &quot; , mid , key );

                if( Framework.Database.IsConnected() == false )
                {
                    return;
                }

                Framework.Database.ExecuteNonQuery( sql );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Deletes all grammer given key the moduleid
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;mid&quot;&gt;int&lt;/param&gt;
        public void DeleteGrammer( int mid )
        {
            try
            {
                if( _grammer == null )
                {
                    BuildGrammerListing();
                }

                for( var y = 0; y &lt; _grammer.Count; y++ )
                {
                    if( _grammer[ y ].GetModuleId() == mid )
                    {
                        _grammer.RemoveAt( y );
                    }
                }

                var sql = string.Format( &quot;delete from moduleGrammerWords where m_id= &#39;{0}&#39;&quot; , mid );

                if( Framework.Database.IsConnected() == false )
                {
                    return;
                }

                Framework.Database.ExecuteNonQuery( sql );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Gets a Grammer given a the moduleid and key
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;mid&quot;&gt;int&lt;/param&gt;
        /// &lt;param name = &quot;key&quot;&gt;string&lt;/param&gt;
        /// &lt;returns&gt;IGrammer&lt;/returns&gt;
        public IGrammer GetGrammer( int mid , string key )
        {
            try
            {
                if( _grammer == null )
                {
                    BuildGrammerListing();
                }

                for( var y = 0; y &lt; _grammer.Count; y++ )
                {
                    if( _grammer[ y ].GetModuleId() == mid &amp;&amp; _grammer[ y ].GetKey().CompareTo( key ) == 0 )
                    {
                        return _grammer[ y ];
                    }
                }

                return null;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
                return null;
            }
        }

        /// &lt;summary&gt;
        ///   Gets a Grammer given a the moduleid and id
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;mid&quot;&gt;int&lt;/param&gt;
        /// &lt;param name = &quot;id&quot;&gt;int&lt;/param&gt;
        /// &lt;returns&gt;IGrammer&lt;/returns&gt;
        public IGrammer GetGrammer( int mid , int id )
        {
            try
            {
                if( _grammer == null )
                {
                    BuildGrammerListing();
                }

                for( var y = 0; y &lt; _grammer.Count; y++ )
                {
                    if( _grammer[ y ].GetModuleId() == mid &amp;&amp; _grammer[ y ].GetId() == id )
                    {
                        return _grammer[ y ];
                    }
                }

                return null;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
                return null;
            }
        }

        /// &lt;summary&gt;
        ///   Gets all Grammer given a the moduleid
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;mid&quot;&gt;int&lt;/param&gt;
        /// &lt;returns&gt;IGrammer list&lt;/returns&gt;
        public List&lt; IGrammer &gt; GetGrammer( int mid )
        {
            var found = new List&lt; IGrammer &gt;();
            try
            {
                if( _grammer == null )
                {
                    BuildGrammerListing();
                }

                for( var y = 0; y &lt; _grammer.Count; y++ )
                {
                    if( _grammer[ y ].GetModuleId() == mid )
                    {
                        found.Add( _grammer[ y ] );
                    }
                }

                return found;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
                return found;
            }
        }

        /// &lt;summary&gt;
        ///   Gets all grammers
        /// &lt;/summary&gt;
        /// &lt;returns&gt;IGrammer List&lt;/returns&gt;
        public List&lt; IGrammer &gt; GetGrammer()
        {
            try
            {
                if( _grammer == null )
                {
                    BuildGrammerListing();
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
            return _grammer;
        }

        /// &lt;summary&gt;
        /// Refreshes the list
        /// &lt;/summary&gt;
        public void Refresh()
        {
            try
            {
                var sql = string.Format( &quot;select * from moduleGrammerWords&quot; );

                if( Framework.Database.IsConnected() == false )
                {
                    return;
                }

                var ds = Framework.Database.ExecuteQuery( sql );

                var clientTable = ds.Tables[ 0 ];

                if( clientTable.Rows.Count == 0 )
                {
                    return;
                }

                foreach( DataRow row in clientTable.Rows )
                {
                    var id = ( int ) row[ &quot;id&quot; ];
                    var mid = ( int ) row[ &quot;m_id&quot; ];
                    var gkey = ( string ) row[ &quot;grammerkey&quot; ];
                    var gvalue = ( string ) row[ &quot;grammerval&quot; ];

                    var newDbEntry = true;

                    for( var y = 0; y &lt; _grammer.Count; y++ )
                    {
                        if( _grammer[ y ].GetId() != id )
                        {
                            continue;
                        }

                        newDbEntry = false;
                        break;
                    }

                    if( !newDbEntry )
                    {
                        continue;
                    }

                    var grammer = new Grammer( id , mid , gkey , gvalue );

                    _grammer.Add( grammer );
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #endregion
    }
}</pre></code><script type="text/javascript">
			applyranges('src164', RANGES_164)
		</script>
	</body>
</html>