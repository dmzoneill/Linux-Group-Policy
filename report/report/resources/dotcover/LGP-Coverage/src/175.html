<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_175 = [
   [26,9,26,10,'dccv']
, [28,13,28,14,'dccv']
, [29,17,29,39,'dccv']
, [34,17,34,102,'dccv']
, [36,17,36,64,'dccv']
, [41,17,41,68,'dccv']
, [42,17,42,18,'dccv']
, [43,21,43,113,'dccv']
, [45,21,45,69,'dccv']
, [47,21,47,50,'dccv']
, [49,21,49,50,'dccv']
, [54,21,54,49,'dccv']
, [57,21,57,95,'dccv']
, [59,21,59,44,'dccv']
, [61,21,61,59,'dccv']
, [71,9,71,10,'dccv']
, [78,9,78,10,'dccv']
, [80,13,80,14,'dccv']
, [81,17,81,39,'dccv']
, [86,17,86,148,'dccv']
, [87,17,87,135,'dccv']
, [89,17,89,55,'dccv']
, [90,17,90,18,'dccv']
, [91,21,91,64,'dccv']
, [92,21,92,64,'dccv']
, [94,26,94,36,'dccv']
, [95,21,95,22,'dccv']
, [96,25,96,89,'dccv']
, [97,25,97,26,'dccv']
, [98,29,98,68,'dccv']
, [99,29,99,52,'dccv']
, [100,29,100,35,'dccv']
, [102,21,102,22,'dccv']
, [94,57,94,60,'dccv']
, [94,37,94,55,'dccv']
, [103,17,103,18,'dccv']
, [104,13,104,14,'dccv']
, [109,9,109,10,'dccv']
, [117,9,117,10,'dccv']
, [119,13,119,14,'dccv']
, [120,17,120,39,'dccv']
, [121,17,121,18,'dccv']
, [122,21,122,42,'dccv']
, [123,17,123,18,'dccv']
, [125,22,125,32,'dccv']
, [126,17,126,18,'dccv']
, [127,21,127,85,'dccv']
, [128,21,128,22,'dccv']
, [129,25,129,46,'dccv']
, [131,17,131,18,'dccv']
, [125,53,125,56,'dccv']
, [125,33,125,51,'dccv']
, [133,17,133,29,'dccv']
, [140,9,140,10,'dccv']
, [213,9,213,10,'dccv']
, [214,13,214,46,'dccv']
, [217,13,217,14,'dccv']
, [218,17,218,68,'dccv']
, [220,17,220,64,'dccv']
, [225,17,225,72,'dccv']
, [227,17,227,58,'dccv']
, [229,17,229,51,'dccv']
, [234,17,234,24,'dccv']
, [234,47,234,64,'dccv']
, [234,26,234,43,'dccv']
, [235,17,235,18,'dccv']
, [236,21,236,107,'dccv']
, [237,21,237,44,'dccv']
, [238,17,238,18,'dccv']
, [234,44,234,46,'dccv']
, [239,13,239,14,'dccv']
, [244,9,244,10,'dccv']
, [30,17,30,18,'dcuc']
, [31,21,31,42,'dcuc']
, [32,17,32,18,'dcuc']
, [37,17,37,18,'dcuc']
, [38,21,38,33,'dcuc']
, [50,21,50,22,'dcuc']
, [51,25,51,37,'dcuc']
, [64,17,64,29,'dcuc']
, [66,13,66,37,'dcuc']
, [67,13,67,14,'dcuc']
, [68,17,68,53,'dcuc']
, [69,17,69,29,'dcuc']
, [82,17,82,18,'dcuc']
, [83,21,83,42,'dcuc']
, [84,17,84,18,'dcuc']
, [105,13,105,37,'dcuc']
, [106,13,106,14,'dcuc']
, [107,17,107,53,'dcuc']
, [108,13,108,14,'dcuc']
, [135,13,135,37,'dcuc']
, [136,13,136,14,'dcuc']
, [137,17,137,53,'dcuc']
, [138,17,138,29,'dcuc']
, [147,9,147,10,'dcuc']
, [148,13,148,35,'dcuc']
, [149,13,149,14,'dcuc']
, [150,17,150,38,'dcuc']
, [151,13,151,14,'dcuc']
, [153,13,153,29,'dcuc']
, [154,9,154,10,'dcuc']
, [160,9,160,10,'dcuc']
, [162,13,162,14,'dcuc']
, [163,17,163,68,'dcuc']
, [165,17,165,64,'dcuc']
, [166,17,166,18,'dcuc']
, [167,21,167,28,'dcuc']
, [170,17,170,72,'dcuc']
, [172,17,172,58,'dcuc']
, [174,17,174,51,'dcuc']
, [175,17,175,18,'dcuc']
, [176,21,176,28,'dcuc']
, [179,17,179,24,'dcuc']
, [179,47,179,64,'dcuc']
, [179,26,179,43,'dcuc']
, [180,17,180,18,'dcuc']
, [181,21,181,43,'dcuc']
, [182,21,182,59,'dcuc']
, [184,26,184,36,'dcuc']
, [185,21,185,22,'dcuc']
, [186,25,186,67,'dcuc']
, [187,25,187,26,'dcuc']
, [188,29,188,38,'dcuc']
, [191,25,191,44,'dcuc']
, [192,25,192,31,'dcuc']
, [184,57,184,60,'dcuc']
, [184,37,184,55,'dcuc']
, [195,21,195,38,'dcuc']
, [196,21,196,22,'dcuc']
, [197,25,197,34,'dcuc']
, [200,21,200,87,'dcuc']
, [201,21,201,44,'dcuc']
, [202,17,202,18,'dcuc']
, [179,44,179,46,'dcuc']
, [203,13,203,14,'dcuc']
, [204,13,204,37,'dcuc']
, [205,13,205,14,'dcuc']
, [206,17,206,53,'dcuc']
, [207,13,207,14,'dcuc']
, [208,9,208,10,'dcuc']
, [221,17,221,18,'dcuc']
, [222,21,222,28,'dcuc']
, [230,17,230,18,'dcuc']
, [231,21,231,28,'dcuc']
, [240,13,240,37,'dcuc']
, [241,13,241,14,'dcuc']
, [242,17,242,53,'dcuc']
, [243,13,243,14,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src175" class="dotCoverSource"><pre>#region

using System;
using System.Collections.Generic;
using System.Data;
using LGP.Components.Database.Entities;
using LGP.Components.Factory;
using LGP.Components.Factory.Interfaces.Database;

#endregion

namespace LGP.Components.Database.Gateways
{
    internal class ModuleGateway : IModuleGateway
    {
        private static List&lt; IModule &gt; _modules;

        #region Implementation of IModuleGateway

        /// &lt;summary&gt;
        ///   Creates a Module
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;modulename&quot;&gt;The new Module name&lt;/param&gt;
        /// &lt;returns&gt;IModule&lt;/returns&gt;
        public IModule CreateModule( string modulename )
        {
            try
            {
                if( _modules == null )
                {
                    BuildModuleListing();
                }

                var sql = string.Format( &quot;insert into modules values( null, &#39;{0}&#39;  )&quot; , modulename );

                if( Framework.Database.IsConnected() == false )
                {
                    return null;
                }

                if( Framework.Database.ExecuteNonQuery( sql ) &gt; 0 )
                {
                    sql = string.Format( &quot;select * from modules where id = ( select MAX( id ) from modules )&quot; );

                    var ds = Framework.Database.ExecuteQuery( sql );

                    var ouTable = ds.Tables[ 0 ];

                    if( ouTable.Rows.Count == 0 )
                    {
                        return null;
                    }

                    var row = ouTable.Rows[ 0 ];


                    var module = new Module( ( int ) row[ &quot;id&quot; ] , ( string ) row[ &quot;name&quot; ] );

                    _modules.Add( module );

                    return _modules[ _modules.Count - 1 ];
                }

                return null;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
                return null;
            }
        }

        /// &lt;summary&gt;
        ///   Deletes an Module
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;modulename&quot;&gt;the module to delete&lt;/param&gt;
        public void DeleteModule( string modulename )
        {
            try
            {
                if( _modules == null )
                {
                    BuildModuleListing();
                }

                var sql1 = string.Format( &quot;delete from moduleGrammerWords where m_id = &#39;{0}&#39;&quot; , this.GetModuleByName( modulename ).GetModuleId() );
                var sql2 = string.Format( &quot;delete from modules where id = &#39;{0}&#39;&quot; , this.GetModuleByName( modulename ).GetModuleId() );

                if( Framework.Database.IsConnected() )
                {
                    Framework.Database.ExecuteNonQuery( sql1 );
                    Framework.Database.ExecuteNonQuery( sql2 );

                    for( var y = 0; y &lt; _modules.Count; y++ )
                    {
                        if( _modules[ y ].GetModuleName().CompareTo( modulename ) == 0 )
                        {
                            _modules[ y ].Dispose( _modules[ y ] );
                            _modules.RemoveAt( y );
                            break;
                        }
                    }
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Gets an IModule given a name
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;modulename&quot;&gt;the module name&lt;/param&gt;
        /// &lt;returns&gt;IModule&lt;/returns&gt;
        public IModule GetModuleByName( string modulename )
        {
            try
            {
                if( _modules == null )
                {
                    BuildModuleListing();
                }

                for( var y = 0; y &lt; _modules.Count; y++ )
                {
                    if( _modules[ y ].GetModuleName().CompareTo( modulename ) == 0 )
                    {
                        return _modules[ y ];
                    }
                }

                return null;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
                return null;
            }
        }

        /// &lt;summary&gt;
        ///   Get the list of modules in the database
        /// &lt;/summary&gt;
        /// &lt;returns&gt;List IModule&lt;/returns&gt;
        public List&lt; IModule &gt; GetModules()
        {
            if( _modules == null )
            {
                BuildModuleListing();
            }

            return _modules;
        }

        /// &lt;summary&gt;
        /// refreshes the list
        /// &lt;/summary&gt;
        public void Refresh()
        {
            try
            {
                var sql = string.Format( &quot;select * from modules&quot; );

                if( Framework.Database.IsConnected() == false )
                {
                    return;
                }

                var modulesds = Framework.Database.ExecuteQuery( sql );

                var modulesTable = modulesds.Tables[ 0 ];

                if( modulesTable.Rows.Count == 0 )
                {
                    return;
                }

                foreach( DataRow moduleRow in modulesTable.Rows )
                {
                    var newDbEntry = true;
                    var modid = ( int ) moduleRow[ &quot;id&quot; ];

                    for( var y = 0; y &lt; _modules.Count; y++ )
                    {
                        if( _modules[ y ].GetModuleId() != modid )
                        {
                            continue;
                        }

                        newDbEntry = false;
                        break;
                    }

                    if( !newDbEntry )
                    {
                        continue;
                    }

                    var module = new Module( modid , ( string ) moduleRow[ &quot;name&quot; ] );
                    _modules.Add( module );
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #endregion

        private static void BuildModuleListing()
        {
            _modules = new List&lt; IModule &gt;();

            try
            {
                var sql = string.Format( &quot;select * from modules&quot; );

                if( Framework.Database.IsConnected() == false )
                {
                    return;
                }

                var modulesds = Framework.Database.ExecuteQuery( sql );

                var modulesTable = modulesds.Tables[ 0 ];

                if( modulesTable.Rows.Count == 0 )
                {
                    return;
                }

                foreach( DataRow moduleRow in modulesTable.Rows )
                {
                    var module = new Module( ( int ) moduleRow[ &quot;id&quot; ] , ( string ) moduleRow[ &quot;name&quot; ] );
                    _modules.Add( module );
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }
    }
}</pre></code><script type="text/javascript">
			applyranges('src175', RANGES_175)
		</script>
	</body>
</html>