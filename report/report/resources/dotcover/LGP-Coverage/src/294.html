<html>
	<head>
		<script type="text/javascript" src="../js/coverreport.js">

		</script><script type="text/javascript">
			RANGES_294 = [
   [42,9,42,85,'dccv']
, [43,9,43,10,'dccv']
, [45,13,45,14,'dccv']
, [46,17,46,44,'dccv']
, [47,17,47,39,'dccv']
, [48,17,48,39,'dccv']
, [49,17,49,35,'dccv']
, [50,17,50,39,'dccv']
, [51,17,51,32,'dccv']
, [52,13,52,14,'dccv']
, [57,9,57,10,'dccv']
, [60,9,60,10,'dccv']
, [62,13,62,14,'dccv']
, [63,17,63,34,'dccv']
, [65,17,65,38,'dccv']
, [69,22,69,62,'dccv']
, [70,17,70,18,'dccv']
, [71,21,71,35,'dccv']
, [72,17,72,18,'dccv']
, [73,22,73,63,'dccv']
, [74,17,74,18,'dccv']
, [75,21,75,35,'dccv']
, [76,17,76,18,'dccv']
, [82,17,82,88,'dccv']
, [83,17,83,51,'dccv']
, [84,17,84,52,'dccv']
, [85,17,85,46,'dccv']
, [86,17,86,47,'dccv']
, [87,17,87,65,'dccv']
, [88,17,88,66,'dccv']
, [90,17,90,186,'dccv']
, [92,17,92,52,'dccv']
, [93,17,93,35,'dccv']
, [94,17,94,18,'dccv']
, [95,21,95,61,'dccv']
, [96,21,96,64,'dccv']
, [97,21,97,97,'dccv']
, [99,21,99,57,'dccv']
, [100,21,100,66,'dccv']
, [101,21,101,101,'dccv']
, [103,21,103,55,'dccv']
, [104,21,104,86,'dccv']
, [105,17,105,18,'dccv']
, [106,13,106,14,'dccv']
, [111,9,111,10,'dccv']
, [115,9,115,10,'dccv']
, [116,9,116,10,'dccv']
, [124,9,124,10,'dccv']
, [125,13,125,33,'dccv']
, [126,9,126,10,'dccv']
, [141,9,141,10,'dccv']
, [142,13,142,71,'dccv']
, [143,13,143,14,'dccv']
, [144,17,144,45,'dccv']
, [145,13,145,14,'dccv']
, [147,13,147,14,'dccv']
, [148,17,148,65,'dccv']
, [149,17,149,41,'dccv']
, [150,17,150,39,'dccv']
, [151,13,151,14,'dccv']
, [156,9,156,10,'dccv']
, [162,9,162,10,'dccv']
, [164,13,164,14,'dccv']
, [165,17,165,67,'dccv']
, [166,17,166,41,'dccv']
, [167,17,167,40,'dccv']
, [168,13,168,14,'dccv']
, [173,9,173,10,'dccv']
, [180,9,180,10,'dccv']
, [182,13,182,14,'dccv']
, [183,17,183,34,'dccv']
, [185,17,185,34,'dccv']
, [186,17,186,18,'dccv']
, [187,21,187,35,'dccv']
, [188,17,188,18,'dccv']
, [189,22,189,54,'dccv']
, [190,17,190,18,'dccv']
, [191,21,191,35,'dccv']
, [192,17,192,18,'dccv']
, [193,22,193,55,'dccv']
, [194,17,194,18,'dccv']
, [195,21,195,35,'dccv']
, [196,17,196,18,'dccv']
, [197,22,197,40,'dccv']
, [198,17,198,18,'dccv']
, [199,21,199,36,'dccv']
, [200,17,200,18,'dccv']
, [202,17,202,47,'dccv']
, [203,17,203,48,'dccv']
, [204,17,204,88,'dccv']
, [205,17,205,42,'dccv']
, [206,17,206,43,'dccv']
, [207,13,207,14,'dccv']
, [212,9,212,10,'dccv']
, [216,9,216,10,'dccv']
, [218,13,218,14,'dccv']
, [219,17,219,31,'dccv']
, [220,17,220,79,'dccv']
, [221,13,221,14,'dccv']
, [226,9,226,10,'dccv']
, [229,9,229,10,'dccv']
, [230,13,230,35,'dccv']
, [231,9,231,10,'dccv']
, [235,9,235,10,'dccv']
, [236,13,236,35,'dccv']
, [237,9,237,10,'dccv']
, [243,9,243,10,'dccv']
, [244,13,244,35,'dccv']
, [245,9,245,10,'dccv']
, [252,9,252,10,'dccv']
, [253,13,253,42,'dccv']
, [255,13,255,43,'dccv']
, [256,13,256,14,'dccv']
, [257,17,257,24,'dccv']
, [260,13,260,14,'dccv']
, [261,17,261,58,'dccv']
, [262,13,262,14,'dccv']
, [267,9,267,10,'dccv']
, [277,9,277,10,'dccv']
, [278,13,278,33,'dccv']
, [284,13,284,14,'dccv']
, [285,17,285,39,'dccv']
, [286,17,286,65,'dccv']
, [287,17,287,39,'dccv']
, [288,13,288,14,'dccv']
, [293,9,293,10,'dccv']
, [30,9,30,40,'dcuc']
, [31,9,31,10,'dcuc']
, [32,13,32,40,'dcuc']
, [33,13,33,35,'dcuc']
, [34,9,34,10,'dcuc']
, [53,13,53,37,'dcuc']
, [54,13,54,14,'dcuc']
, [55,17,55,53,'dcuc']
, [56,13,56,14,'dcuc']
, [66,17,66,18,'dcuc']
, [67,21,67,35,'dcuc']
, [68,17,68,18,'dcuc']
, [77,22,77,44,'dcuc']
, [78,17,78,18,'dcuc']
, [79,21,79,36,'dcuc']
, [80,17,80,18,'dcuc']
, [107,13,107,37,'dcuc']
, [108,13,108,14,'dcuc']
, [109,17,109,53,'dcuc']
, [110,13,110,14,'dcuc']
, [133,9,133,10,'dcuc']
, [134,13,134,35,'dcuc']
, [135,9,135,10,'dcuc']
, [152,13,152,37,'dcuc']
, [153,13,153,14,'dcuc']
, [154,17,154,53,'dcuc']
, [155,13,155,14,'dcuc']
, [169,13,169,37,'dcuc']
, [170,13,170,14,'dcuc']
, [171,17,171,53,'dcuc']
, [172,13,172,14,'dcuc']
, [208,13,208,37,'dcuc']
, [209,13,209,14,'dcuc']
, [210,17,210,53,'dcuc']
, [211,13,211,14,'dcuc']
, [222,13,222,37,'dcuc']
, [223,13,223,14,'dcuc']
, [224,17,224,53,'dcuc']
, [225,13,225,14,'dcuc']
, [263,13,263,37,'dcuc']
, [264,13,264,14,'dcuc']
, [265,17,265,53,'dcuc']
, [266,13,266,14,'dcuc']
, [279,13,279,14,'dcuc']
, [280,17,280,24,'dcuc']
, [289,13,289,37,'dcuc']
, [290,13,290,14,'dcuc']
, [291,17,291,53,'dcuc']
, [292,13,292,14,'dcuc']
, [300,9,300,10,'dcuc']
, [302,13,302,14,'dcuc']
, [303,13,303,14,'dcuc']
, [304,13,304,37,'dcuc']
, [305,13,305,14,'dcuc']
, [306,17,306,53,'dcuc']
, [307,13,307,14,'dcuc']
, [308,9,308,10,'dcuc']
, [315,9,315,10,'dcuc']
, [317,13,317,14,'dcuc']
, [318,13,318,14,'dcuc']
, [319,13,319,37,'dcuc']
, [320,13,320,14,'dcuc']
, [321,17,321,53,'dcuc']
, [322,13,322,14,'dcuc']
, [323,9,323,10,'dcuc']
, [329,9,329,10,'dcuc']
, [331,13,331,14,'dcuc']
, [332,13,332,14,'dcuc']
, [333,13,333,37,'dcuc']
, [334,13,334,14,'dcuc']
, [335,17,335,53,'dcuc']
, [336,13,336,14,'dcuc']
, [337,9,337,10,'dcuc']
, [344,9,344,10,'dcuc']
, [346,13,346,14,'dcuc']
, [347,17,347,36,'dcuc']
, [348,17,348,56,'dcuc']
, [349,17,349,48,'dcuc']
, [350,13,350,14,'dcuc']
, [351,13,351,37,'dcuc']
, [352,13,352,14,'dcuc']
, [353,17,353,53,'dcuc']
, [354,13,354,14,'dcuc']
, [355,9,355,10,'dcuc']
];
		</script><link rel="stylesheet" type="text/css" href="../css/coverreport.css" />
	</head><body>
		<code id="src294" class="dotCoverSource"><pre>#region

using System;
using System.Reflection;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;
using System.Windows.Media;
using LGP.Components.Factory;
using LGP.Components.Factory.Interfaces.Database;
using LGP.Modules.OrganizationUnitExplorer.Internal.NodeViews;

#endregion

namespace LGP.Modules.OrganizationUnitExplorer.Internal.CustomControls
{
    /// &lt;summary&gt;
    ///   Interaction logic for WrapPanelClientElement.xaml
    /// &lt;/summary&gt;
    public partial class WrapPanelClientElement : IClientObserver
    {
        private static WrapPanelClientElement _selectedElement;
        private readonly OuViewer _parent;
        private readonly int _size;
        private IClient _client;
        private bool _selected;

        /// &lt;summary&gt;
        /// &lt;/summary&gt;
        public WrapPanelClientElement()
        {
            this.InitializeComponent();
            this.AllowDrop = true;
        }


        /// &lt;summary&gt;
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;client&quot;&gt;&lt;/param&gt;
        /// &lt;param name = &quot;size&quot;&gt;&lt;/param&gt;
        /// &lt;param name = &quot;parent&quot;&gt;&lt;/param&gt;
        public WrapPanelClientElement( IClient client , int size , OuViewer parent )
        {
            try
            {
                this.InitializeComponent();
                client.Attach( this );
                this._client = client;
                this._size = size;
                this._parent = parent;
                this.Prepare();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        private void Prepare()
        {
            try
            {
                var fakeSize = 0;

                if( this._size &lt; 40 )
                {
                    fakeSize = 32;
                }
                else if( this._size &lt; 56 &amp;&amp; this._size &gt; 40 )
                {
                    fakeSize = 48;
                }
                else if( this._size &lt; 90 &amp;&amp; this._size &gt;= 56 )
                {
                    fakeSize = 64;
                }
                else if( this._size &gt;= 90 )
                {
                    fakeSize = 128;
                }

                this.ItemImage.Source = this._client.GetDistroImage( fakeSize ).Source;
                this.ItemImage.Width = this._size;
                this.ItemImage.Height = this._size;
                this.Width = this._size + 58;
                this.Height = this._size + 48;
                this.ItemLabel.Content = this._client.GetName();
                this.ItemImage.MouseDown += this.EntityMouseDown;

                var resource = Framework.Utils.LoadResource( Assembly.GetExecutingAssembly() , &quot;LGP.Modules.OrganizationUnitExplorer.Internal.ContextMenuItems.ClientContextMenu.xaml&quot; );

                var menu = resource as ContextMenu;
                if( menu != null )
                {
                    var item = ( MenuItem ) menu.Items[ 0 ];
                    item.Click += this.MoveClientMenuItemClick;
                    item.Icon = Framework.Images.GetImage( &quot;Move&quot; , &quot;VS2010ImageLibrary&quot; , 12 );

                    item = ( MenuItem ) menu.Items[ 1 ];
                    item.Click += this.DeleteClientMenuItemClick;
                    item.Icon = Framework.Images.GetImage( &quot;DeleteHS&quot; , &quot;VS2010ImageLibrary&quot; , 12 );

                    this.ItemImage.ContextMenu = menu;
                    this.ItemImage.ContextMenuOpening += this.MenuContextMenuOpening;
                }
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private void MenuContextMenuOpening( object sender , ContextMenuEventArgs e )
        {
        }


        /// &lt;summary&gt;
        ///   Get the client associated with this wrapper
        /// &lt;/summary&gt;
        /// &lt;returns&gt;IOu&lt;/returns&gt;
        public IClient GetClient()
        {
            return this._client;
        }


        /// &lt;summary&gt;
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public bool IsSelected()
        {
            return this._selected;
        }


        /// &lt;summary&gt;
        /// &lt;/summary&gt;
        public void Select()
        {
            if( _selectedElement != null &amp;&amp; _selectedElement != this )
            {
                _selectedElement.DeSelect();
            }
            try
            {
                this.ItemBorder.BorderBrush = Brushes.LightBlue;
                _selectedElement = this;
                this._selected = true;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        /// &lt;summary&gt;
        /// &lt;/summary&gt;
        public void DeSelect()
        {
            try
            {
                this.ItemBorder.BorderBrush = Brushes.Transparent;
                _selectedElement = null;
                this._selected = false;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        /// &lt;summary&gt;
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;resize&quot;&gt;&lt;/param&gt;
        public void Resize( int resize )
        {
            try
            {
                var fakeSize = 0;

                if( resize &lt; 40 )
                {
                    fakeSize = 32;
                }
                else if( resize &lt; 56 &amp;&amp; resize &gt; 40 )
                {
                    fakeSize = 48;
                }
                else if( resize &lt; 90 &amp;&amp; resize &gt;= 56 )
                {
                    fakeSize = 64;
                }
                else if( resize &gt;= 90 )
                {
                    fakeSize = 128;
                }

                this.ItemImage.Width = resize;
                this.ItemImage.Height = resize;
                this.ItemImage.Source = this._client.GetDistroImage( fakeSize ).Source;
                this.Width = resize + 58;
                this.Height = resize + 48;
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }


        private void EntityMouseDown( object sender , MouseButtonEventArgs e )
        {
            try
            {
                this.Select();
                this._parent.SetDetailsPane( new ClientPane( this._client ) );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        private void MoveClientMenuItemClick( object sender , RoutedEventArgs e )
        {
            this._parent.Update();
        }


        private void DeleteClientMenuItemClick( object sender , RoutedEventArgs e )
        {
            this._parent.Update();
        }

        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        public void Update()
        {
            this._parent.Update();
        }

        /// &lt;summary&gt;
        ///   Invoked when an unhandled &lt;see cref = &quot;E:System.Windows.Input.Mouse.PreviewMouseMove&quot; /&gt;&nbsp;attached event reaches an element in its route that is derived from this class. Implement this method to add class handling for this event.
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;e&quot;&gt;The &lt;see cref = &quot;T:System.Windows.Input.MouseEventArgs&quot; /&gt; that contains the event data.&lt;/param&gt;
        protected override void OnPreviewMouseMove( MouseEventArgs e )
        {
            base.OnPreviewMouseMove( e );

            if( this != _selectedElement )
            {
                return;
            }
            try
            {
                Framework.DragDrop.StartDrag( this , e );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #region Implementation of IClientObserver

        /// &lt;summary&gt;
        ///   Update this observer with a refernece to the client
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;client&quot;&gt;IClient&lt;/param&gt;
        /// &lt;param name = &quot;source&quot;&gt;source observer&lt;/param&gt;
        public void Update( IClient client , IClientObserver source )
        {
            if( this == source )
            {
                return;
            }

            try
            {
                this._client = client;
                this.ItemLabel.Content = this._client.GetName();
                this._parent.Update();
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Attach objewcts that observer this client
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;obj&quot;&gt;IOuObserver&lt;/param&gt;
        public void Attach( IClientObserver obj )
        {
            try
            {
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Detach objewcts that observer this client
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;obj&quot;&gt;IOuObserver&lt;/param&gt;
        public void Detach( IClientObserver obj )
        {
            try
            {
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Notify observers of this client
        /// &lt;/summary&gt;
        public void Notify()
        {
            try
            {
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        /// &lt;summary&gt;
        ///   Dispose this object and all the observers
        /// &lt;/summary&gt;
        /// &lt;param name = &quot;obj&quot;&gt;IOuObserver&lt;/param&gt;
        public void Dispose( IClientObserver obj )
        {
            try
            {
                obj.Detach( this );
                var parent = ( WrapPanel ) this.Parent;
                parent.Children.Remove( this );
            }
            catch( Exception error )
            {
                Framework.EventBus.Publish( error );
            }
        }

        #endregion
    }
}</pre></code><script type="text/javascript">
			applyranges('src294', RANGES_294)
		</script>
	</body>
</html>